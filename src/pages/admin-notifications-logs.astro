---
// P√°gina: Panel Duplex de Notificaciones y Logs de Auditor√≠a - SOLO ADMIN
import DashboardLayout from '../layouts/DashboardLayout.astro';

// Datos simulados de notificaciones del sistema
const systemNotifications = [
  {
    id: 'NOT-001',
    type: 'success',
    title: 'Vacaci√≥n Aprobada',
    message: 'Mar√≠a L√≥pez aprob√≥ la solicitud de vacaciones de Carlos Rodr√≠guez',
    user: 'Mar√≠a L√≥pez (HR)',
    timestamp: '2025-12-15 10:23:45',
    read: false
  },
  {
    id: 'NOT-002',
    type: 'warning',
    title: 'Candidato en Espera',
    message: 'El candidato Elena Rodr√≠guez lleva 5 d√≠as sin respuesta de entrevista',
    user: 'Sistema',
    timestamp: '2025-12-15 09:15:00',
    read: false
  },
  {
    id: 'NOT-003',
    type: 'info',
    title: 'Nueva Vacante Creada',
    message: 'Se cre√≥ la vacante "Senior DevOps Engineer" en departamento Engineering',
    user: 'Admin (admin@hexalink.com)',
    timestamp: '2025-12-14 16:45:30',
    read: true
  },
  {
    id: 'NOT-004',
    type: 'success',
    title: 'Candidato Contratado',
    message: 'Laura Garc√≠a S√°nchez fue contratada como HR Manager',
    user: 'Mar√≠a L√≥pez (HR)',
    timestamp: '2025-12-14 14:20:00',
    read: true
  },
  {
    id: 'NOT-005',
    type: 'danger',
    title: 'Solicitud Rechazada',
    message: 'Se rechaz√≥ la solicitud de vacaciones de Pedro Garc√≠a por cuota excedida',
    user: 'Mar√≠a L√≥pez (HR)',
    timestamp: '2025-12-13 11:00:00',
    read: true
  }
];

// Datos simulados de logs de auditor√≠a
const auditLogs = [
  {
    id: 'LOG-001',
    action: 'LOGIN',
    description: 'Inicio de sesi√≥n exitoso',
    user: 'admin@hexalink.com',
    ip: '192.168.1.100',
    timestamp: '2025-12-15 10:30:22',
    module: 'Auth'
  },
  {
    id: 'LOG-002',
    action: 'CREATE',
    description: 'Cre√≥ nueva vacante: Senior DevOps Engineer',
    user: 'admin@hexalink.com',
    ip: '192.168.1.100',
    timestamp: '2025-12-15 10:28:15',
    module: 'Vacancies'
  },
  {
    id: 'LOG-003',
    action: 'UPDATE',
    description: 'Actualiz√≥ estado de candidato CAN-002 a "Interview"',
    user: 'hr@hexalink.com',
    ip: '192.168.1.105',
    timestamp: '2025-12-15 09:45:00',
    module: 'Candidates'
  },
  {
    id: 'LOG-004',
    action: 'APPROVE',
    description: 'Aprob√≥ solicitud de vacaciones VAC-REQ-001',
    user: 'hr@hexalink.com',
    ip: '192.168.1.105',
    timestamp: '2025-12-15 09:30:45',
    module: 'Vacations'
  },
  {
    id: 'LOG-005',
    action: 'DELETE',
    description: 'Elimin√≥ empleado EMP-010 (Juan Test)',
    user: 'admin@hexalink.com',
    ip: '192.168.1.100',
    timestamp: '2025-12-14 18:00:00',
    module: 'Employees'
  },
  {
    id: 'LOG-006',
    action: 'LOGIN_FAILED',
    description: 'Intento de login fallido (contrase√±a incorrecta)',
    user: 'unknown@test.com',
    ip: '192.168.1.200',
    timestamp: '2025-12-14 17:45:30',
    module: 'Auth'
  },
  {
    id: 'LOG-007',
    action: 'CREATE',
    description: 'Registr√≥ nuevo empleado: Roberto D√≠az Campos',
    user: 'hr@hexalink.com',
    ip: '192.168.1.105',
    timestamp: '2025-12-14 15:20:00',
    module: 'Employees'
  },
  {
    id: 'LOG-008',
    action: 'REJECT',
    description: 'Rechaz√≥ solicitud de vacaciones VAC-REQ-005',
    user: 'hr@hexalink.com',
    ip: '192.168.1.105',
    timestamp: '2025-12-14 14:00:00',
    module: 'Vacations'
  }
];
---

<DashboardLayout title="Notificaciones y Logs - Admin - HexaLink ERP">
  <style>
    .admin-panel {
      max-width: 1600px;
      margin: 0 auto;
      padding: 2rem;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      flex-wrap: wrap;
      gap: 1rem;
    }

    .page-title {
      color: #f1f5f9;
      font-size: 2rem;
      font-weight: 700;
    }

    .header-badge {
      background: linear-gradient(90deg, #0d9488 0%, #0e7490 100%);
      color: white;
      padding: 0.5rem 1rem;
      border-radius: 50px;
      font-size: 0.85rem;
      font-weight: 600;
    }

    .header-actions {
      display: flex;
      gap: 1rem;
    }

    .btn-header {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }

    .btn-primary {
      background: #0d9488;
      color: white;
    }

    .btn-primary:hover {
      background: #0e7490;
    }

    .btn-secondary {
      background: #334155;
      color: #cbd5e1;
    }

    .btn-secondary:hover {
      background: #475569;
    }

    /* Duplex Panel */
    .duplex-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    @media (max-width: 1200px) {
      .duplex-container {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 16px;
      overflow: hidden;
    }

    .panel-header {
      background: linear-gradient(90deg, #0d9488 0%, #0e7490 100%);
      padding: 1.5rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .panel-header.logs {
      background: linear-gradient(90deg, #3b82f6 0%, #1d4ed8 100%);
    }

    .panel-title {
      color: white;
      font-size: 1.3rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .panel-badge {
      background: rgba(255, 255, 255, 0.2);
      padding: 0.25rem 0.75rem;
      border-radius: 50px;
      font-size: 0.85rem;
    }

    .panel-content {
      padding: 1.5rem;
      max-height: 600px;
      overflow-y: auto;
    }

    /* Notifications */
    .notification-item {
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 12px;
      padding: 1.25rem;
      margin-bottom: 1rem;
      transition: all 0.3s;
      cursor: pointer;
    }

    .notification-item:hover {
      border-color: #0d9488;
      transform: translateX(5px);
    }

    .notification-item.unread {
      border-left: 4px solid #0d9488;
    }

    .notification-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 0.75rem;
    }

    .notification-type {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .notification-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .notification-icon.success { background: #22c55e; }
    .notification-icon.warning { background: #f59e0b; }
    .notification-icon.info { background: #3b82f6; }
    .notification-icon.danger { background: #ef4444; }

    .notification-title {
      color: #f1f5f9;
      font-weight: 600;
    }

    .notification-time {
      color: #64748b;
      font-size: 0.8rem;
    }

    .notification-message {
      color: #cbd5e1;
      font-size: 0.95rem;
      margin-bottom: 0.5rem;
    }

    .notification-user {
      color: #94a3b8;
      font-size: 0.85rem;
    }

    /* Audit Logs */
    .log-item {
      background: #0f172a;
      border: 1px solid #334155;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 0.75rem;
      font-family: 'Consolas', 'Monaco', monospace;
      transition: all 0.3s;
    }

    .log-item:hover {
      border-color: #3b82f6;
      background: #1e293b;
    }

    .log-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .log-action {
      padding: 0.25rem 0.75rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 700;
      text-transform: uppercase;
    }

    .log-action.LOGIN { background: #22c55e; color: white; }
    .log-action.LOGIN_FAILED { background: #ef4444; color: white; }
    .log-action.CREATE { background: #3b82f6; color: white; }
    .log-action.UPDATE { background: #f59e0b; color: white; }
    .log-action.DELETE { background: #ef4444; color: white; }
    .log-action.APPROVE { background: #22c55e; color: white; }
    .log-action.REJECT { background: #ef4444; color: white; }

    .log-module {
      background: #334155;
      padding: 0.2rem 0.6rem;
      border-radius: 4px;
      font-size: 0.75rem;
      color: #cbd5e1;
    }

    .log-description {
      color: #f1f5f9;
      font-size: 0.9rem;
      margin-bottom: 0.5rem;
    }

    .log-meta {
      display: flex;
      gap: 1.5rem;
      font-size: 0.8rem;
      color: #64748b;
    }

    .log-meta span {
      display: flex;
      align-items: center;
      gap: 0.25rem;
    }

    /* Filters */
    .filters-bar {
      display: flex;
      gap: 1rem;
      padding: 1rem 1.5rem;
      background: #0f172a;
      border-bottom: 1px solid #334155;
      flex-wrap: wrap;
    }

    .filter-select {
      padding: 0.5rem 1rem;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 6px;
      color: #cbd5e1;
      font-size: 0.9rem;
      cursor: pointer;
    }

    .filter-select:focus {
      outline: none;
      border-color: #0d9488;
    }

    .filter-input {
      padding: 0.5rem 1rem;
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 6px;
      color: #f1f5f9;
      flex: 1;
      min-width: 200px;
    }

    .filter-input::placeholder {
      color: #64748b;
    }

    /* Stats Bar */
    .stats-bar {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .stat-mini {
      background: #1e293b;
      border: 1px solid #334155;
      border-radius: 10px;
      padding: 1rem 1.5rem;
      text-align: center;
    }

    .stat-mini-value {
      color: #0d9488;
      font-size: 1.8rem;
      font-weight: 700;
    }

    .stat-mini-label {
      color: #94a3b8;
      font-size: 0.85rem;
    }

    @media (max-width: 768px) {
      .stats-bar {
        grid-template-columns: repeat(2, 1fr);
      }

      .filters-bar {
        flex-direction: column;
      }
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: #94a3b8;
    }

    .empty-state-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }
  </style>

  <div class="admin-panel">
    <!-- Header -->
    <div class="page-header">
      <div>
        <h1 class="page-title">üìä Panel de Control</h1>
        <p style="color: #94a3b8; margin-top: 0.5rem;">Notificaciones del sistema y Logs de auditor√≠a</p>
      </div>
      <div class="header-actions">
        <span class="header-badge">üîê Solo Admin</span>
        <button class="btn-header btn-secondary">üì• Exportar Logs</button>
        <button class="btn-header btn-primary">üîÑ Actualizar</button>
      </div>
    </div>

    <!-- Stats Bar -->
    <div class="stats-bar">
      <div class="stat-mini">
        <div class="stat-mini-value">5</div>
        <div class="stat-mini-label">Notificaciones Nuevas</div>
      </div>
      <div class="stat-mini">
        <div class="stat-mini-value">128</div>
        <div class="stat-mini-label">Logs Hoy</div>
      </div>
      <div class="stat-mini">
        <div class="stat-mini-value">3</div>
        <div class="stat-mini-label">Alertas Activas</div>
      </div>
      <div class="stat-mini">
        <div class="stat-mini-value">99.9%</div>
        <div class="stat-mini-label">Uptime Sistema</div>
      </div>
    </div>

    <!-- Duplex Panel -->
    <div class="duplex-container">
      <!-- Panel Izquierdo: Notificaciones -->
      <div class="panel">
        <div class="panel-header">
          <span class="panel-title">
            üîî Notificaciones del Sistema
            <span class="panel-badge">5 nuevas</span>
          </span>
        </div>

        <div class="filters-bar">
          <select class="filter-select">
            <option value="">Todos los tipos</option>
            <option value="success">‚úì Aprobaciones</option>
            <option value="warning">‚ö†Ô∏è Advertencias</option>
            <option value="info">‚ÑπÔ∏è Informaci√≥n</option>
            <option value="danger">‚úï Rechazos</option>
          </select>
          <select class="filter-select">
            <option value="">Todas las fechas</option>
            <option value="today">Hoy</option>
            <option value="week">Esta semana</option>
            <option value="month">Este mes</option>
          </select>
        </div>

        <div class="panel-content">
          {systemNotifications.map((notif) => (
            <div class={`notification-item ${!notif.read ? 'unread' : ''}`}>
              <div class="notification-header">
                <div class="notification-type">
                  <div class={`notification-icon ${notif.type}`}>
                    {notif.type === 'success' && '‚úì'}
                    {notif.type === 'warning' && '‚ö†'}
                    {notif.type === 'info' && '‚Ñπ'}
                    {notif.type === 'danger' && '‚úï'}
                  </div>
                  <span class="notification-title">{notif.title}</span>
                </div>
                <span class="notification-time">{notif.timestamp}</span>
              </div>
              <p class="notification-message">{notif.message}</p>
              <span class="notification-user">üë§ {notif.user}</span>
            </div>
          ))}
        </div>
      </div>

      <!-- Panel Derecho: Logs de Auditor√≠a -->
      <div class="panel">
        <div class="panel-header logs">
          <span class="panel-title">
            üìú Logs de Auditor√≠a
            <span class="panel-badge">128 hoy</span>
          </span>
        </div>

        <div class="filters-bar">
          <select class="filter-select">
            <option value="">Todas las acciones</option>
            <option value="LOGIN">Login</option>
            <option value="CREATE">Crear</option>
            <option value="UPDATE">Actualizar</option>
            <option value="DELETE">Eliminar</option>
            <option value="APPROVE">Aprobar</option>
            <option value="REJECT">Rechazar</option>
          </select>
          <select class="filter-select">
            <option value="">Todos los m√≥dulos</option>
            <option value="Auth">Auth</option>
            <option value="Employees">Empleados</option>
            <option value="Candidates">Candidatos</option>
            <option value="Vacations">Vacaciones</option>
            <option value="Vacancies">Vacantes</option>
          </select>
          <input type="text" class="filter-input" placeholder="Buscar por usuario o descripci√≥n...">
        </div>

        <div class="panel-content">
          {auditLogs.map((log) => (
            <div class="log-item">
              <div class="log-header">
                <span class={`log-action ${log.action}`}>{log.action.replace('_', ' ')}</span>
                <span class="log-module">{log.module}</span>
              </div>
              <p class="log-description">{log.description}</p>
              <div class="log-meta">
                <span>üë§ {log.user}</span>
                <span>üåê {log.ip}</span>
                <span>üïê {log.timestamp}</span>
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>

  <script>
    // Verificar que solo Admin puede ver esta p√°gina
    document.addEventListener('DOMContentLoaded', () => {
      try {
        const authData = localStorage.getItem('authToken');
        if (authData) {
          const user = JSON.parse(authData);
          if (user.role !== 'admin') {
            alert('‚ö†Ô∏è Esta p√°gina es solo para administradores');
            window.location.href = '/my-profile';
          }
        } else {
          window.location.href = '/login';
        }
      } catch (e) {
        console.error('Error verificando permisos:', e);
      }
    });

    // Bot√≥n actualizar
    document.querySelector('.btn-primary')?.addEventListener('click', () => {
      location.reload();
    });

    // Bot√≥n exportar
    document.querySelector('.btn-secondary')?.addEventListener('click', () => {
      alert('Exportando logs a CSV... (funcionalidad a implementar con backend)');
    });
  </script>
</DashboardLayout>
